/* =========================
   TaraCommute â€“ Dashboard CSS (FULL)
   - Dark mode affects UI panel + chat only
   - Map stays unchanged
   - Commute Buddy: rainbow header + send + bubbles + proper hide rules
   - Dark scrollbars in dark mode (panel + chat)
   ========================= */

/* Base tokens */
:root{
  --brand:#d61f2c;
  --radius:18px;
  --shadow: 0 20px 60px rgba(2,6,23,.18);
}

/* Theme variables */
:root{
  --bg:#ffffff;
  --panel: rgba(255,255,255,.95);
  --text:#111827;
  --muted: rgba(17,24,39,.75);
  --border: rgba(17,24,39,.12);
  --line: rgba(229,231,235,.85);

  --inputBg: rgba(255,255,255,.92);
  --btnBg: rgba(17,24,39,.06);

  --surface: rgba(255,255,255,.75);
  --surface2: rgba(17,24,39,.06);
  --surfaceHover: rgba(17,24,39,.10);
  --focusRing: rgba(148,163,184,.25);
}

[data-theme="dark"]{
  --bg:#0b1220;
  --panel: rgba(17,24,39,.92);
  --text:#e5e7eb;
  --muted: rgba(229,231,235,.72);
  --border: rgba(229,231,235,.14);
  --line: rgba(229,231,235,.10);

  --inputBg: rgba(255,255,255,.06);
  --btnBg: rgba(255,255,255,.10);

  --surface: rgba(255,255,255,.06);
  --surface2: rgba(255,255,255,.10);
  --surfaceHover: rgba(255,255,255,.14);
  --focusRing: rgba(30,144,255,.20);

  --shadow: 0 20px 60px rgba(0,0,0,.45);
}

/* Global */
*{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif; }
body{ margin:0; background: var(--bg); color: var(--text); }

/* Map: never darken */
#map{ position:absolute; inset:0; }
#map, #map * { filter:none !important; }

/* PANEL */
.panel{
  position:absolute;
  left:12px; top:12px;
  width:min(540px, calc(100vw - 24px));
  max-height: calc(100vh - 24px);

  background: var(--panel);
  border: 1px solid var(--border);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  box-shadow: var(--shadow);

  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.panelHeader{
  padding:14px 14px 10px;
  border-bottom:1px solid var(--line);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.title{ font-weight:1000; font-size:18px; margin:0; letter-spacing:-0.01em; color: var(--text); }
.sub{ color:var(--muted); font-size:12px; margin-top:4px; font-weight:650; }


#themeToggle{
  border-radius: 999px;         
  padding: 10px 14px;            
  white-space: nowrap;           
  line-height: 1;                
  min-height: 37px;              
  display: inline-flex;         
  align-items: center;
  justify-content: center;
}

.btnLogout{
  border:0;
  border-radius:999px;
  padding:10px 14px;
  background: var(--rainbow);
  background-size:300% 300%;
  animation: rainbowShift 8s ease infinite;
  color:#fff;
  cursor:pointer;
  font-weight:1000;
  white-space:nowrap;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}
.btnLogout:hover{ filter: brightness(1.03); transform: translateY(-1px); }

/* BUTTONS (general) */
button{
  padding:10px 12px;
  border:0;
  border-radius:14px;
  background: var(--text);
  color: var(--bg);
  cursor:pointer;
  font-size:12px;
  font-weight:1000;
}
button:hover{ transform: translateY(-1px); }

button.secondary,
.secondary{
  background: var(--btnBg);
  border: 1px solid var(--border);
  color: var(--text);
}
button.secondary:hover,
.secondary:hover{ background: var(--surfaceHover); }

/* TABS */
.tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  padding:10px 14px;
  border-bottom:1px solid var(--line);
}
.tab{
  border:1px solid var(--border);
  background: var(--surface2);
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  user-select:none;
  font-weight:900;
  color: var(--text);
}
.tab:hover{ background: var(--surfaceHover); }
.tab.active{
  background: var(--text);
  color: var(--bg);
  border-color: transparent;
}

/* Legend */
.legend{
  display:flex;
  gap:12px;
  font-size:13px;
  margin-top:6px;
  padding: 0 14px 10px;
}
.legend span{
  display:flex;
  align-items:center;
  gap:4px;
  font-weight:600;
}


/* SEARCH */
.controls{
  display:flex;
  gap:8px;
  padding:10px 14px;
  border-bottom:1px solid var(--line);
  align-items:center;
}
.controls input{
  flex:1;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  outline:none;
  background: var(--inputBg);
  color: var(--text);
}
.controls input::placeholder{ color: var(--muted); }
.controls input:focus{
  border-color: rgba(148,163,184,.55);
  box-shadow:0 0 0 4px var(--focusRing);
}

/* BOARD AREA */
#boardContainer{ flex:1; overflow:auto; }
.board{ padding:12px 14px 14px; }

.boardTitle{ font-weight:1000; margin-bottom:10px; color: var(--text); }
.boardControls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

select{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background: var(--inputBg);
  color: var(--text);
  font-weight:800;
}

/* META */
.metaRow{ margin-top:8px; color:var(--muted); font-size:12px; font-weight:650; }

/* DEPARTURES */
.departure{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
  border-top:1px solid var(--line);
}
.left{ display:flex; align-items:flex-start; gap:10px; }
.badge{
  padding:4px 10px;
  border-radius:999px;
  color:#fff;
  font-size:12px;
  white-space:nowrap;
  font-weight:1000;
}
.destination{ font-weight:1000; color: var(--text); }
.small{ font-size:12px; color:var(--muted); margin-top:3px; font-weight:650; }
.minutes{ font-weight:1000; color: var(--text); }

/* MOBILE */
@media (max-width: 420px){
  .panel{ width: calc(100vw - 24px); }
  .panelHeader{ align-items:center; }
}

/* =============================
   ðŸŒˆ Commute Buddy (Rainbow UI + Bubbles)
   ============================= */

@keyframes rainbowShift{
  0%{ background-position:0% 50%; }
  50%{ background-position:100% 50%; }
  100%{ background-position:0% 50%; }
}
:root{
  --rainbow: linear-gradient(90deg,#ff3c3c,#ff7a00,#ffd400,#33d17a,#1e90ff,#7c3aed,#ff3bd4);
}

/* Button (lower-right; moved up to avoid Mapbox controls) */
#commuteBuddyBtn{
  position:absolute;
  right:50px;
  bottom:30px;
  z-index:999;

  padding:12px 18px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:900;
  color:#fff;

  background: var(--rainbow);
  background-size:300% 300%;
  animation: rainbowShift 10s linear infinite;

  box-shadow:0 10px 25px rgba(0,0,0,.25);
}
#commuteBuddyBtn:hover{ transform: translateY(-1px); }

/* Backdrop */
#cbBackdrop{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.25);
  z-index:998;
}

/* Panel */
#commuteBuddyPanel{
  position:fixed;
  right:20px;
  bottom:20px;
  width:min(380px, calc(100vw - 40px));
  height:480px;

  background: var(--panel);
  border: 1px solid var(--border);
  border-radius:18px;
  box-shadow: var(--shadow);
  overflow:hidden;

  display:flex;
  flex-direction:column;
  z-index:1000;
}

/* âœ… Hide/show rules that wonâ€™t get overridden */
#commuteBuddyPanel.cb-hidden{ display:none !important; }
#cbBackdrop.cb-hidden{ display:none !important; }
#commuteBuddyPanel:not(.cb-hidden){ display:flex !important; }
#cbBackdrop:not(.cb-hidden){ display:block !important; }

/* Header (rainbow) */
.cb-header{
  padding:12px 14px;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;

  background: var(--rainbow);
  background-size:300% 300%;
  animation: rainbowShift 10s linear infinite;
}
.cb-header span{ font-weight:1000; letter-spacing:-.01em; }

#cbClose{
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.35);
  background: rgba(0,0,0,.18);
  color:#fff;
  cursor:pointer;
  font-weight:1000;
}
#cbClose:hover{ filter: brightness(1.05); }

/* Messages area */
.cb-messages{
  flex:1;
  padding:14px 12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Bubble base */
.cb-bubble{
  max-width:82%;
  padding:10px 12px;
  border-radius:14px;
  line-height:1.35;
  font-size:14px;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
  word-wrap:break-word;
  white-space:pre-wrap;
}

/* Buddy bubble (left) */
.cb-buddy{
  align-self:flex-start;
  background: var(--surface);
  border:1px solid var(--border);
  color: var(--text);
}

/* You bubble (right, rainbow) */
.cb-you{
  align-self:flex-end;
  color:#fff;
  border:1px solid rgba(255,255,255,.22);

  background: var(--rainbow);
  background-size:300% 300%;
  animation: rainbowShift 5s linear infinite;

}

/* Label under bubble */
.cb-meta{
  margin-top:6px;
  font-size:11px;
  opacity:.72;
  color: var(--muted);
}

/* Input area */
.cb-input-area{
  display:flex;
  gap:10px;
  padding:12px;
  border-top:1px solid var(--line);
  background: rgba(255,255,255,.70);
}
[data-theme="dark"] .cb-input-area{
  background: rgba(17,24,39,.75);
}

.cb-input-area input{
  flex:1;
  border-radius:999px;
  border:1px solid var(--border);
  padding:10px 12px;
  outline:none;
  background: var(--inputBg);
  color: var(--text);
}
.cb-input-area input::placeholder{ color: var(--muted); }
.cb-input-area input:focus{
  border-color: rgba(30,144,255,.55);
  box-shadow: 0 0 0 4px var(--focusRing);
}

/* Send button (rainbow) */
#cbSend{
  border:none;
  border-radius:999px;
  padding:10px 16px;
  color:#fff;
  font-weight:1000;
  cursor:pointer;

  background: var(--rainbow);
  background-size:300% 300%;
  animation: rainbowShift 10s linear infinite;

  box-shadow:0 10px 22px rgba(0,0,0,.18);
}
#cbSend:hover{ transform: translateY(-1px); }

/* =============================
   ðŸŒ™ Dark-mode scrollbars (panel + chat + everything)
   ============================= */

/* Firefox */
[data-theme="dark"]{
  scrollbar-color: rgba(255,255,255,.28) rgba(255,255,255,.08);
  scrollbar-width: thin;
}

/* Chrome/Edge/Safari */
[data-theme="dark"] ::-webkit-scrollbar{
  width:10px;
  height:10px;
}
[data-theme="dark"] ::-webkit-scrollbar-track{
  background: rgba(255,255,255,.06);
  border-radius: 10px;
}
[data-theme="dark"] ::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.28);
  border-radius: 999px;
  border:2px solid transparent;
  background-clip: content-box;
}
[data-theme="dark"] ::-webkit-scrollbar-thumb:hover{
  background: rgba(255,255,255,.40);
}



/* âœ… HARD OVERRIDE: hide when cb-hidden is present */
#commuteBuddyPanel.cb-hidden { display: none !important; }
#cbBackdrop.cb-hidden { display: none !important; }

/* âœ… Show only when cb-hidden is removed */
#commuteBuddyPanel:not(.cb-hidden) { display: flex !important; }
#cbBackdrop:not(.cb-hidden) { display: block !important; }

/* ======================================================
   PANEL-ONLY AURORA (no map tint)
   Paste at bottom of dashboard.css
====================================================== */

/* Hide the full-screen aurora layer on dashboard */
.aurora.aurora--neon{
  display: none !important;
}

/* Make sure panels can host overlay layers */
.panel,
#commuteBuddyPanel{
  position: relative;
  overflow: hidden;
}

/* Keep actual content above the glow */
.panel > *,
#commuteBuddyPanel > *{
  position: relative;
  z-index: 1;
}

/* Shared aurora overlay */
.panel::before,
#commuteBuddyPanel::before{
  content:"";
  position:absolute;
  inset:-80px;                 /* bleed for blur */
  z-index: 0;
  pointer-events:none;

  opacity: .55;
  filter: blur(42px) saturate(1.5) contrast(1.1);
  transform: translateZ(0);

  background:
  radial-gradient(360px 280px at var(--mx) var(--my),
    rgba(255,255,255,.92) 0%,
    rgba(255,255,255,.35) 36%,
    rgba(255,255,255,0) 72%),

  /* ðŸ”¥ Warm red glow */
  radial-gradient(520px 360px at calc(var(--mx) + 18%) calc(var(--my) - 14%),
    rgba(255, 60, 60, .40) 0%,
    rgba(255, 60, 60, 0) 72%),

  /* ðŸŸ  Orange energy */
  radial-gradient(560px 420px at calc(var(--mx) - 20%) calc(var(--my) + 12%),
    rgba(255, 140, 0, .38) 0%,
    rgba(255, 140, 0, 0) 74%),

  /* ðŸ’› Yellow highlight */
  radial-gradient(520px 380px at 60% 80%,
    rgba(255, 210, 0, .35) 0%,
    rgba(255, 210, 0, 0) 70%),

  /* ðŸ’– Keep a touch of pink for balance */
  radial-gradient(620px 440px at 30% 78%,
    rgba(255, 0, 140, .28) 0%,
    rgba(255, 0, 140, 0) 74%),

  /* ðŸ’™ Soft blue for contrast */
  radial-gradient(720px 520px at 72% 22%,
    rgba(0, 170, 255, .25) 0%,
    rgba(0, 170, 255, 0) 76%);

}

/* Dark mode: reduce white, keep neon */
[data-theme="dark"] .panel::before,
[data-theme="dark"] #commuteBuddyPanel::before{
  opacity: .35;
  filter: blur(56px) saturate(1.65) contrast(1.18);

 background:


  /* ðŸ”¥ Warm red glow */
  radial-gradient(520px 360px at calc(var(--mx) + 18%) calc(var(--my) - 14%),
    rgba(255, 60, 60, .40) 0%,
    rgba(255, 60, 60, 0) 72%),

  /* ðŸŸ  Orange energy */
  radial-gradient(560px 420px at calc(var(--mx) - 20%) calc(var(--my) + 12%),
    rgba(255, 140, 0, .38) 0%,
    rgba(255, 140, 0, 0) 74%),

  /* ðŸ’› Yellow highlight */
  radial-gradient(520px 380px at 60% 80%,
    rgba(255, 210, 0, .35) 0%,
    rgba(255, 210, 0, 0) 70%),

  /* ðŸ’– Keep a touch of pink for balance */
  radial-gradient(620px 440px at 30% 78%,
    rgba(255, 0, 140, .28) 0%,
    rgba(255, 0, 140, 0) 74%),

  /* ðŸ’™ Soft blue for contrast */
  radial-gradient(720px 520px at 72% 22%,
    rgba(0, 170, 255, .25) 0%,
    rgba(0, 170, 255, 0) 76%);



}

/* ======================================================
   âœ… FINAL OVERRIDES (put at VERY BOTTOM)
   - Backdrop becomes INVISIBLE (no map tint)
   - Force AI panel to stay bottom-right
====================================================== */

/* 1) Backdrop: keep it for "click outside to close" but NO visuals */
#cbBackdrop{
  background: transparent !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 2) FORCE the chat panel position (prevents it jumping left) */
#commuteBuddyPanel{
  position: fixed !important;
  left: auto !important;
  top: auto !important;
  right: 20px !important;
  bottom: 20px !important;
  margin: 0 !important;
}

/* 3) FORCE button position too */
#commuteBuddyBtn{
  position: fixed !important;
  right: 50px !important;
  bottom: 30px !important;
  left: auto !important;
  top: auto !important;
}


/* Dark mode keeps animation but slightly brighter */
[data-theme="dark"] .cb-you{
  filter: brightness(1.08) saturate(1.05);
}