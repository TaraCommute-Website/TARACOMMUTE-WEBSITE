/* =========================
   TaraCommute â€“ Dashboard CSS
   Dark mode affects UI panel only.
   Map stays unchanged (no dark reminders applied to #map).
   ========================= */

/* Core tokens */
:root{
  --brand:#d61f2c;
  --ink:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --shadow: 0 20px 60px rgba(2,6,23,.18);
  --radius:18px;
}

/* ===== Theme variables ===== */
:root{
  --bg: #ffffff;
  --panel: rgba(255,255,255,.92);
  --text: #111827;
  --subtle: rgba(17,24,39,.75);
  --border: rgba(17,24,39,.12);

  --surface: rgba(255,255,255,.75);  /* inputs / cards */
  --surface2: rgba(17,24,39,.06);    /* tabs / secondary buttons */
  --surfaceHover: rgba(17,24,39,.10);
  --focusRing: rgba(30,144,255,.18);
  --shadow: 0 20px 60px rgba(2,6,23,.18);
}

[data-theme="dark"]{
  --bg: #0b1220;
  --panel: rgba(17,24,39,.92);
  --text: #e5e7eb;
  --subtle: rgba(229,231,235,.72);
  --border: rgba(229,231,235,.14);

  --surface: rgba(255,255,255,.06);
  --surface2: rgba(255,255,255,.10);
  --surfaceHover: rgba(255,255,255,.14);
  --focusRing: rgba(30,144,255,.20);
  --shadow: 0 20px 60px rgba(0,0,0,.45);
}

/* Global base */
*{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif; }
body{
  margin:0;
  background: var(--bg);
  color: var(--text);
}

/* Map always unaffected by theme */
#map{ position:absolute; inset:0; }
#map, #map * { filter:none !important; }

/* PANEL */
.panel{
  position:absolute;
  left:12px; top:12px;
  width:min(540px, calc(100vw - 24px));
  max-height: calc(100vh - 24px);

  background: var(--panel);
  border: 1px solid var(--border);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  box-shadow: var(--shadow);

  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.panelHeader{
  padding:14px 14px 10px;
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}

.title{
  font-weight:1000;
  font-size:18px;
  margin:0;
  letter-spacing:-0.01em;
  color: var(--text);
}

.sub{
  color: var(--subtle);
  font-size:12px;
  margin-top:4px;
  font-weight:650;
}

/* Logout button (brand stays) */
.btnLogout{
  border:0;
  border-radius:999px;
  padding:10px 14px;
  background: var(--brand);
  color:#fff;
  cursor:pointer;
  font-weight:1000;
  white-space:nowrap;
}
.btnLogout:hover{ filter: brightness(1.03); transform: translateY(-1px); }

/* Default button (primary) */
button{
  padding:10px 12px;
  border:0;
  border-radius:14px;
  background: var(--text);
  color: var(--bg);
  cursor:pointer;
  font-size:12px;
  font-weight:1000;
}
button:hover{ transform: translateY(-1px); }

/* Secondary buttons respect theme */
button.secondary,
.secondary{
  background: var(--surface2);
  border: 1px solid var(--border);
  color: var(--text);
}
button.secondary:hover,
.secondary:hover{
  background: var(--surfaceHover);
}

/* TABS */
.tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  padding:10px 14px;
  border-bottom:1px solid var(--border);
}

.tab{
  border:1px solid var(--border);
  background: var(--surface2);
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  user-select:none;
  font-weight:900;
  color: var(--text);
}
.tab:hover{ background: var(--surfaceHover); }

.tab.active{
  background: var(--text);
  color: var(--bg);
  border-color: transparent;
}

/* Rail legend */
.legend{
  display:flex;
  gap:12px;
  font-size:13px;
  margin-top:6px;
  padding: 0 14px 10px;
}
.legend span{
  display:flex;
  align-items:center;
  gap:4px;
  font-weight:600;
}
.legend .lrt1{ color:#2563eb; }
.legend .lrt2{ color:#9333ea; }
.legend .mrt { color:#facc15; }

/* SEARCH / CONTROLS */
.controls{
  display:flex;
  gap:8px;
  padding:10px 14px;
  border-bottom:1px solid var(--border);
  align-items:center;
}

.controls input{
  flex:1;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  outline:none;
  background: var(--surface);
  color: var(--text);
}
.controls input::placeholder{ color: var(--subtle); }

.controls input:focus{
  border-color: rgba(148,163,184,.55);
  box-shadow:0 0 0 4px var(--focusRing);
}

/* BOARD AREA */
#boardContainer{ flex:1; overflow:auto; }
.board{ padding:12px 14px 14px; }

.boardTitle{ font-weight:1000; margin-bottom:10px; color: var(--text); }
.boardControls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

select{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  font-weight:800;
}

/* META */
.metaRow{
  margin-top:8px;
  color: var(--subtle);
  font-size:12px;
  font-weight:650;
}

/* DEPARTURES */
.departure{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
  border-top:1px solid var(--border);
}
.left{ display:flex; align-items:flex-start; gap:10px; }

.badge{
  padding:4px 10px;
  border-radius:999px;
  color:#fff;
  font-size:12px;
  white-space:nowrap;
  font-weight:1000;
}

.destination{ font-weight:1000; color: var(--text); }
.small{ font-size:12px; color: var(--subtle); margin-top:3px; font-weight:650; }
.minutes{ font-weight:1000; color: var(--text); }

/* MOBILE */
@media (max-width: 420px){
  .panel{ width: calc(100vw - 24px); }
  .panelHeader{ align-items:center; }
}

/* ============================= */
/* ðŸŒˆ Commute Buddy (UI + Bubbles) */
/* ============================= */

/* Button (lower-right, lifted to avoid Mapbox controls) */
#commuteBuddyBtn{
  position:absolute;
  right:50px;
  bottom:30px; /* avoids Mapbox zoom controls */
  z-index:999;

  padding:12px 18px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:900;
  color:#fff;

  background: linear-gradient(90deg,
    #ff004c, #ff7a00, #ffd400, #33d17a, #1e90ff, #7c3aed, #ff3bd4);
  background-size: 300% 300%;
  animation: cbRainbow 8s ease infinite;

  box-shadow:0 10px 25px rgba(0,0,0,.25);
}
#commuteBuddyBtn:hover{ transform: translateY(-1px); }

@keyframes cbRainbow{
  0%{ background-position:0% 50%; }
  50%{ background-position:100% 50%; }
  100%{ background-position:0% 50%; }
}

/* Visibility rules (prevents auto-show / specificity bugs) */
#commuteBuddyPanel.cb-hidden{ display:none !important; }
#cbBackdrop.cb-hidden{ display:none !important; }
#commuteBuddyPanel:not(.cb-hidden){ display:flex !important; }
#cbBackdrop:not(.cb-hidden){ display:block !important; }

/* Backdrop */
#cbBackdrop{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.25);
  z-index:998;
}

/* Panel */
#commuteBuddyPanel{
  position:fixed;
  right:20px;
  bottom:20px;
  width:min(360px, calc(100vw - 40px));
  height:460px;

  background: rgba(255,255,255,.92);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(15,23,42,.12);
  border-radius:18px;
  box-shadow:0 20px 60px rgba(2,6,23,.20);
  overflow:hidden;

  flex-direction:column;
  z-index:1000;
}

/* Make panel match theme */
[data-theme="dark"] #commuteBuddyPanel{
  background: rgba(17,24,39,.92);
  border: 1px solid rgba(229,231,235,.14);
}

/* Header with rainbow gradient */
.cb-header{
  padding:12px 14px;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;

  background: linear-gradient(90deg,
    #ff004c, #ff7a00, #ffd400, #33d17a, #1e90ff, #7c3aed, #ff3bd4);
  background-size: 300% 300%;
  animation: cbRainbow 8s ease infinite;
}
.cb-header span{ font-weight:1000; letter-spacing:-.01em; }

#cbClose{
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.35);
  background: rgba(0,0,0,.18);
  color:#fff;
  cursor:pointer;
  font-weight:1000;
}
#cbClose:hover{ filter: brightness(1.05); }

/* Messages area */
.cb-messages{
  flex:1;
  padding:14px 12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Bubble base */
.cb-bubble{
  max-width:82%;
  padding:10px 12px;
  border-radius:14px;
  line-height:1.35;
  font-size:14px;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
  word-wrap:break-word;
  white-space:pre-wrap;
}

/* Buddy bubble (left) */
.cb-buddy{
  align-self:flex-start;
  background: rgba(255,255,255,.95);
  border:1px solid rgba(15,23,42,.10);
  color: var(--text);
}
[data-theme="dark"] .cb-buddy{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(229,231,235,.14);
}

/* You bubble (right) */
.cb-you{
  align-self:flex-end;
  color:#fff;
  border:1px solid rgba(255,255,255,.22);

  background: linear-gradient(90deg,
    #ff004c, #ff7a00, #ffd400, #33d17a, #1e90ff, #7c3aed, #ff3bd4);
  background-size: 300% 300%;
  animation: cbRainbow 8s ease infinite;
}

/* Small label under bubble */
.cb-meta{
  margin-top:6px;
  font-size:11px;
  opacity:.72;
  color: var(--subtle);
}

/* Input area */
.cb-input-area{
  display:flex;
  gap:10px;
  padding:12px;
  border-top:1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.88);
}
[data-theme="dark"] .cb-input-area{
  border-top:1px solid rgba(229,231,235,.14);
  background: rgba(17,24,39,.88);
}

.cb-input-area input{
  flex:1;
  border-radius:999px;
  border:1px solid rgba(15,23,42,.14);
  padding:10px 12px;
  outline:none;
  background: rgba(255,255,255,.98);
  color: var(--text);
}
[data-theme="dark"] .cb-input-area input{
  border:1px solid rgba(229,231,235,.14);
  background: rgba(255,255,255,.06);
}

.cb-input-area input:focus{
  border-color: rgba(30,144,255,.55);
  box-shadow: 0 0 0 4px var(--focusRing);
}

/* Send button (rainbow) */
#cbSend{
  border:none;
  border-radius:999px;
  padding:10px 16px;
  color:#fff;
  font-weight:1000;
  cursor:pointer;

  background: linear-gradient(90deg,
    #ff004c, #ff7a00, #ffd400, #33d17a, #1e90ff, #7c3aed, #ff3bd4);
  background-size: 300% 300%;
  animation: cbRainbow 8s ease infinite;

  box-shadow:0 10px 22px rgba(0,0,0,.18);
}
#cbSend:hover{ transform: translateY(-1px); }



/* âœ… HARD OVERRIDE: hide when cb-hidden is present */
#commuteBuddyPanel.cb-hidden { display: none !important; }
#cbBackdrop.cb-hidden { display: none !important; }

/* âœ… Show only when cb-hidden is removed */
#commuteBuddyPanel:not(.cb-hidden) { display: flex !important; }
#cbBackdrop:not(.cb-hidden) { display: block !important; }



